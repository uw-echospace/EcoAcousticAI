name: Parallel Part 2

on:
  workflow_run:
    workflows: ["Parallel Birdnet and Batdetect"]  # Name of the first workflow
    types:
      - completed
  workflow_dispatch:  # Allows manual trigger

jobs:
  run_batdetect_part2:
    runs-on: ubuntu-latest
    if: always()
    steps:

      - name: Set up SSH Key for Remote Access
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.JETSTREAM2_SSH_KEY }}" > ~/.ssh/jetstream2_key
          chmod 600 ~/.ssh/jetstream2_key
          ssh-keyscan -H "149.165.170.20" >> ~/.ssh/known_hosts

      - name: Bat detect part 2
        run: |
            SSH_KEY=$HOME/.ssh/jetstream2_key
            ssh -o StrictHostKeyChecking=no -i "$SSH_KEY" ubuntu@149.165.170.20 << EOF
              cd /home/ubuntu/EcoAcousticAI/
  
              echo "Contents of new_directories.txt:"
              cat new_directories.txt
              echo "----------------------"

              chmod +x ./docker_runs/run_batdetect_part2.sh
              ./docker_runs/run_batdetect_part2.sh

  run_frognet_part2:
    runs-on: ubuntu-latest
    if: always()
    steps:
            
    - name: Set up SSH Key for Remote Access
      run: |
           mkdir -p ~/.ssh
           echo "${{ secrets.JETSTREAM2_SSH_KEY }}" > ~/.ssh/jetstream2_key
           chmod 600 ~/.ssh/jetstream2_key
           ssh-keyscan -H "149.165.170.20" >> ~/.ssh/known_hosts
            
    - name: Bat frognet part 2
      run: |
            SSH_KEY=$HOME/.ssh/jetstream2_key
            ssh -o StrictHostKeyChecking=no -i "$SSH_KEY" ubuntu@149.165.170.20 << EOF
              cd /home/ubuntu/EcoAcousticAI/
      
                echo "Contents of new_directories.txt:"
                cat new_directories.txt
                echo "----------------------"
            
                chmod +x ./docker_runs/run_frognet_part2.sh
                ./docker_runs/run_frognet_part2.sh
            
